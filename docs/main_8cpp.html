<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Ball-and-Beam Balance System: main.cpp File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Ball-and-Beam Balance System
   &#160;<span id="projectnumber">Version 1</span>
   </div>
   <div id="projectbrief">Doxygen documentation for the beam-and-ball balance system designed and coded by Grant Gallagher, Bradley Kwan, and Zach Richter. [ME 507 Fall 2020]</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('main_8cpp.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">main.cpp File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;Arduino.h&gt;</code><br />
<code>#include &lt;PrintStream.h&gt;</code><br />
<code>#include &quot;<a class="el" href="taskshare_8h_source.html">taskshare.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="taskqueue_8h_source.html">taskqueue.h</a>&quot;</code><br />
<code>#include &lt;Wire.h&gt;</code><br />
<code>#include &lt;<a class="el" href="inclinometer_8h_source.html">inclinometer.h</a>&gt;</code><br />
<code>#include &quot;HardwareTimer.h&quot;</code><br />
<code>#include &lt;encoder_counter.h&gt;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for main.cpp:</div>
<div class="dyncontent">
<div class="center"><img src="main_8cpp__incl.png" border="0" usemap="#amain_8cpp" alt=""/></div>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ad34c28b7e77e784ff26a914b58f53c77"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8cpp.html#ad34c28b7e77e784ff26a914b58f53c77">task_IMU</a> (void *p_params)</td></tr>
<tr class="memdesc:ad34c28b7e77e784ff26a914b58f53c77"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read the current value from the IMU.  <a href="main_8cpp.html#ad34c28b7e77e784ff26a914b58f53c77">More...</a><br /></td></tr>
<tr class="separator:ad34c28b7e77e784ff26a914b58f53c77"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a85cb4a0ff328214a627f134949b87f55"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8cpp.html#a85cb4a0ff328214a627f134949b87f55">task_stateController</a> (void *p_params)</td></tr>
<tr class="memdesc:a85cb4a0ff328214a627f134949b87f55"><td class="mdescLeft">&#160;</td><td class="mdescRight">Implements full-state feedback to determine the required torque to center the ball.  <a href="main_8cpp.html#a85cb4a0ff328214a627f134949b87f55">More...</a><br /></td></tr>
<tr class="separator:a85cb4a0ff328214a627f134949b87f55"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac029ad595d36039f79e8e56407a19e26"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8cpp.html#ac029ad595d36039f79e8e56407a19e26">task_encoder</a> (void *p_params)</td></tr>
<tr class="memdesc:ac029ad595d36039f79e8e56407a19e26"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reads current encoder values from the DC motor.  <a href="main_8cpp.html#ac029ad595d36039f79e8e56407a19e26">More...</a><br /></td></tr>
<tr class="separator:ac029ad595d36039f79e8e56407a19e26"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a867ba384b8150cdf5153453fea63d50b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8cpp.html#a867ba384b8150cdf5153453fea63d50b">task_motorDriver</a> (void *p_params)</td></tr>
<tr class="memdesc:a867ba384b8150cdf5153453fea63d50b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Outputs appropriate PWM value to motor.  <a href="main_8cpp.html#a867ba384b8150cdf5153453fea63d50b">More...</a><br /></td></tr>
<tr class="separator:a867ba384b8150cdf5153453fea63d50b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa4847fe479e4868d57d8a05f599f098a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8cpp.html#aa4847fe479e4868d57d8a05f599f098a">task_linearpot</a> (void *p_params)</td></tr>
<tr class="memdesc:aa4847fe479e4868d57d8a05f599f098a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reads value from Linear Potentiometer.  <a href="main_8cpp.html#aa4847fe479e4868d57d8a05f599f098a">More...</a><br /></td></tr>
<tr class="separator:aa4847fe479e4868d57d8a05f599f098a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4fc01d736fe50cf5b977f755b675f11d"><td class="memItemLeft" align="right" valign="top"><a id="a4fc01d736fe50cf5b977f755b675f11d"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>setup</b> ()</td></tr>
<tr class="separator:a4fc01d736fe50cf5b977f755b675f11d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afe461d27b9c48d5921c00d521181f12f"><td class="memItemLeft" align="right" valign="top"><a id="afe461d27b9c48d5921c00d521181f12f"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>loop</b> ()</td></tr>
<tr class="separator:afe461d27b9c48d5921c00d521181f12f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a999d2baa12ad87e2f23c5b70c51165ae"><td class="memItemLeft" align="right" valign="top"><a id="a999d2baa12ad87e2f23c5b70c51165ae"></a>
float&#160;</td><td class="memItemRight" valign="bottom"><b>encoder_timing</b> = 5</td></tr>
<tr class="separator:a999d2baa12ad87e2f23c5b70c51165ae"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a22dba6843b8365cba71ee8d1bdbda2e5"><td class="memItemLeft" align="right" valign="top"><a id="a22dba6843b8365cba71ee8d1bdbda2e5"></a>
float&#160;</td><td class="memItemRight" valign="bottom"><b>linear_pot_timing</b> = 5</td></tr>
<tr class="separator:a22dba6843b8365cba71ee8d1bdbda2e5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac8e0305e7669354928c99c5e81033f26"><td class="memItemLeft" align="right" valign="top"><a id="ac8e0305e7669354928c99c5e81033f26"></a>
<a class="el" href="classQueue.html">Queue</a>&lt; int16_t &gt;&#160;</td><td class="memItemRight" valign="bottom"><b>linearPot_queue</b> (5)</td></tr>
<tr class="separator:ac8e0305e7669354928c99c5e81033f26"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad09a9aafaf7e84f5ce0eb4199e1de341"><td class="memItemLeft" align="right" valign="top"><a id="ad09a9aafaf7e84f5ce0eb4199e1de341"></a>
<a class="el" href="classQueue.html">Queue</a>&lt; int16_t &gt;&#160;</td><td class="memItemRight" valign="bottom"><b>encoder_queue</b> (5)</td></tr>
<tr class="separator:ad09a9aafaf7e84f5ce0eb4199e1de341"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9a3f464639bca1ec335688ea2f628396"><td class="memItemLeft" align="right" valign="top"><a id="a9a3f464639bca1ec335688ea2f628396"></a>
<a class="el" href="classQueue.html">Queue</a>&lt; int16_t &gt;&#160;</td><td class="memItemRight" valign="bottom"><b>accelerations</b> (4)</td></tr>
<tr class="separator:a9a3f464639bca1ec335688ea2f628396"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4a4fdeb88e15ca259f73aaf7cde540c2"><td class="memItemLeft" align="right" valign="top"><a id="a4a4fdeb88e15ca259f73aaf7cde540c2"></a>
<a class="el" href="classShare.html">Share</a>&lt; float &gt;&#160;</td><td class="memItemRight" valign="bottom"><b>duty_cycle_share</b> (&quot;Duty Cycle&quot;)</td></tr>
<tr class="separator:a4a4fdeb88e15ca259f73aaf7cde540c2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af41f085dadb9eff49ca51bb35761fa73"><td class="memItemLeft" align="right" valign="top"><a id="af41f085dadb9eff49ca51bb35761fa73"></a>
<a class="el" href="classShare.html">Share</a>&lt; bool &gt;&#160;</td><td class="memItemRight" valign="bottom"><b>mot_dir_share</b> (&quot;Motor Direction&quot;)</td></tr>
<tr class="separator:af41f085dadb9eff49ca51bb35761fa73"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This file defines and schedules the tasks necessary to run the term project created by Team Balanced 2020.</p>
<dl class="section author"><dt>Author</dt><dd>Grant Gallagher </dd>
<dd>
Bradley Kwan </dd>
<dd>
Zach Richter</dd></dl>
<dl class="section date"><dt>Date</dt><dd>01-Novemeber-2020 </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="ac029ad595d36039f79e8e56407a19e26"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac029ad595d36039f79e8e56407a19e26">&#9670;&nbsp;</a></span>task_encoder()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void task_encoder </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>p_params</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Reads current encoder values from the DC motor. </p>
<p>The purpose of this task is to continuously read values from the encoder and write them into a queue such that the controller task aware of the current position of the motor as well as the velocity of the motor based on the last reading. Note: this function users timer 3 channels 1 and 2. Although there are other pins on the ST32, it seems that pin PA6 and PA7 cannot be used to also initialize timer 3. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">p_params</td><td>A point to function parameters which are not used. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ad34c28b7e77e784ff26a914b58f53c77"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad34c28b7e77e784ff26a914b58f53c77">&#9670;&nbsp;</a></span>task_IMU()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void task_IMU </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>p_params</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Read the current value from the IMU. </p>
<p>This task calls <code>inclinometer()</code> which provides the code with the current angle of the beam relative to horizontal. <b>NOTE:</b> The following line of code may need to be modified depending on the orientation of the IMU relative to the beam. The main fix will typically be how the <code>atan2</code> function is used to calculate the angle of the beam. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">p_params</td><td>A pointer to function parameters which are not used. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="aa4847fe479e4868d57d8a05f599f098a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa4847fe479e4868d57d8a05f599f098a">&#9670;&nbsp;</a></span>task_linearpot()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void task_linearpot </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>p_params</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Reads value from Linear Potentiometer. </p>
<p>The following task reads the voltage reading from the linear potentiometer. The value is then normalized and then written into a queue such that the current position and average velocity can be found.</p>
<p>Note: <code>analogRead()</code> provides 0 - 1023 reading from 0 - 3.3 V </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">p_params</td><td>A point to function parameters which are not used. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a867ba384b8150cdf5153453fea63d50b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a867ba384b8150cdf5153453fea63d50b">&#9670;&nbsp;</a></span>task_motorDriver()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void task_motorDriver </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>p_params</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Outputs appropriate PWM value to motor. </p>
<p>The following task reads from <code>duty_cycle_share</code> to write the correct duty cycle value to the motor driver chip. Additionally, the direction of the motor is determined from <code>mot_dir_share</code> which is sent to the PH pin of the motor driver chip. In short, one pin receives the PWM signal (always positive) while the other pin determines the direction of the motor based on logic HIGH/LOW. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">p_params</td><td>A point to function parameters which are not used. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a85cb4a0ff328214a627f134949b87f55"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a85cb4a0ff328214a627f134949b87f55">&#9670;&nbsp;</a></span>task_stateController()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void task_stateController </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>p_params</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Implements full-state feedback to determine the required torque to center the ball. </p>
<p>This task takes in readings from the encoder and the linear potentiometer to determine the states of the system: r, r_dot, theta, theta_dot. Through these values, they can be multiplied against the caclulated gain matrix to determine the necessary torque to position the ball at the center of the beam.</p><ul>
<li>The state machine has the following states:<ul>
<li>0: Calibration</li>
<li>1: Active Control <dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">p_params</td><td>A pointer to function parameters which are not used. </td></tr>
  </table>
  </dd>
</dl>
</li>
</ul>
</li>
</ul>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="main_8cpp.html">main.cpp</a></li>
    <li class="footer">Generated by <a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
